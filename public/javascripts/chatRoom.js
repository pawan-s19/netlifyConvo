var socket=io(),roomtag=document.querySelectorAll(".roomName"),allUsersCtn=document.querySelectorAll(".allUsersCtn"),typingdiv=document.querySelector(".typing"),flash=document.querySelector(".typing small"),txt=document.querySelector("textarea"),alertmsg=document.querySelector("pre"),alertdiv=document.querySelector("#alert");let ctn=document.querySelector(".msgCtn");var istyping=!1,timeout=void 0,userName="default",audio=new Audio("/media/messageArrived.mp3"),joinedAudio=new Audio("/media/joined.mp3"),leftAudio=new Audio("/media/left.mp3");const box2=document.querySelector("#box2"),box1=document.querySelector("#box1"),participants=document.querySelector(".participants"),ol=document.querySelector("#popupOverlay"),popup=document.querySelector("#popup");var clicked=!1,{uname:uname,room:room}=Qs.parse(location.search,{ignoreQueryPrefix:!0});roomtag.forEach((e=>{e.textContent=`${room}`}));let getTime=()=>{const e=new Date;let t=e.getHours(),i=e.getMinutes();i=i>=0&&i<10?`0${i}`:i;let o=t>=12?"pm":"am";return t=t%12||12,t=12===t||11===t||10===t?t:`0${t}`,{hour:t,minutes:i,ampm:o}};function scrollToTop(){ctn.scrollTop=ctn.scrollHeight}function sender(){let e=document.querySelector("textarea").value;""!==e.trim()&&socket.emit("msg",{userName:uname,msgs:e,time:getTime()}),document.querySelector("textarea").value="",clearTimeout(timeout),typingTimeout()}function typingTimeout(){istyping=!1,socket.emit("typing",{uname:uname,istyping:istyping})}function outputUsers(e){var t="";e.forEach((function(e){t+=`<div class="users">\n      <h5>${e.username}</h5>\n      <div class="dot"></div>\n    </div>`})),allUsersCtn.forEach((e=>{e.innerHTML=t}))}function outputOnlineNum(e){document.querySelectorAll(".onlineNum").forEach((t=>{t.textContent=`${e.length}`,e.length<=1?txt.disabled=!0:txt.disabled=!1}))}function alert(e){"joined"===e.msg?joinedAudio.play():leftAudio.play(),alertmsg.textContent=`${e.user} ${e.msg} the chat`,document.querySelector("#alert").classList.add("start"),document.querySelector("#alert").style.display="block",setTimeout((()=>{document.querySelector("#alert").classList.remove("start"),document.querySelector("#alert").style.display="none"}),3e3)}socket.emit("joinRoom",{uname:uname,room:room}),document.querySelector("#send").addEventListener("click",(function(){sender()})),document.querySelector("textarea").addEventListener("keyup",(function(e){13===e.keyCode&&sender()})),socket.on("roomUsers",(({room:e,users:t})=>{outputUsers(t),outputOnlineNum(t)})),document.querySelector("textarea").addEventListener("keypress",(function(e){13!==e.keyCode&&(istyping=!0,clearTimeout(timeout),timeout=setTimeout(typingTimeout,1e3),socket.emit("typing",{uname:uname,istyping:istyping}))})),socket.on("display",(function(e){!0===e.istyping?(flash.textContent=`${e.uname} is typing`,typingdiv.style.display="flex"):(flash.textContent="",typingdiv.style.display="none")}));var count=0;socket.on("reply",(function(e){e.id===socket.id?0===count?(document.querySelector(".msgCtn").innerHTML+=`<div class="msgWrapper aRight">\n          <h6>You, ${e.data.time.hour}:${e.data.time.minutes} ${e.data.time.ampm}</h6>\n          <div class="textHolder">\n              <div class="triR"></div>\n              <h3>${e.data.msgs}</h3>\n          </div>\n        </div>`,count++):document.querySelector(".msgCtn").innerHTML+=`<div class="msgWrapper aRight">\n        <div class="textHolder">\n            <div class="triR"></div>\n            <h3>${e.data.msgs}</h3>\n        </div>\n      </div>`:(count=0,document.querySelector(".msgCtn").innerHTML+=`<div class="msgWrapper">\n          <h6>${e.data.userName}, ${e.data.time.hour}:${e.data.time.minutes} ${e.data.time.ampm}</h6>\n          <div class="textHolder">\n              <div class="triL"></div>\n              <h3>${e.data.msgs}</h3>\n          </div>\n        </div>`,audio.play()),setTimeout((()=>{ctn.lastChild.style.transform="scale(1)"}),0),scrollToTop()})),socket.on("alert",(e=>{typingdiv.style.display="none",alert(e)}));const removeLeftDiv=()=>{participants.style.width="0px",participants.style.opacity="0",participants.style.padding="0px",box2.classList.remove("activated"),box1.classList.add("activated")};function myFunction(e){e.matches?clicked&&(ol.style.display="initial",popup.classList.add("fadeUp")):(ol.style.display="none",clicked||removeLeftDiv())}box2.addEventListener("click",(()=>{clicked=!0,participants.style.width="300px",participants.style.opacity="1",participants.style.padding="0px 8px",box1.classList.remove("activated"),box2.classList.add("activated"),x.matches&&(ol.style.display="initial",popup.classList.add("fadeUp"))})),box1.addEventListener("click",(()=>{removeLeftDiv(),clicked=!1})),document.querySelector("#back").addEventListener("click",(()=>{removeLeftDiv(),clicked=!1}));var app=function(){var e=void 0,t=void 0,i=function(){t.addEventListener("click",(function(){return o(e,"nav-active")}))},o=function(e,t){e.classList.contains(t)?e.classList.remove(t):e.classList.add(t)};e=document.querySelector("body"),t=document.querySelector(".menu-icon"),document.querySelectorAll(".nav__list-item"),i()};app(),window.addEventListener("click",(e=>{"popupOverlay"===e.target.id&&(ol.style.display="none",box2.classList.remove("activated"),box1.classList.add("activated"),clicked=!1,popup.classList.remove("fadeUp"))}));var x=window.matchMedia("(max-width: 600px)");myFunction(x),x.addListener(myFunction),window.addEventListener("resize",(()=>{scrollToTop()}));const getDeviceType=()=>{const e=navigator.userAgent;return console.log(window.navigator),/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(e)?"tablet":/Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)?(txt.addEventListener("keyup",(()=>{istyping=!0,clearTimeout(timeout),timeout=setTimeout(typingTimeout,1e3),socket.emit("typing",{uname:uname,istyping:istyping})})),"mobile"):"desktop"};getDeviceType(),gsap.from(".logo",{duration:1,opacity:0,x:"-100%",ease:"power4.inOut"}),gsap.from(".label",{duration:1,opacity:0,x:"100%",ease:"power4.inOut"}),gsap.from(".tagline",{duration:1,opacity:0,y:"-100%",ease:"power4.inOut"}),gsap.from("#room",{duration:1,opacity:0,rotate:90,ease:"power1.inOut",scale:0}),gsap.from("#vid",{duration:1,opacity:0,rotate:90,ease:"power1.inOut",scale:0}),gsap.from("#txt",{duration:1,opacity:0,rotate:90,ease:"power1.inOut",scale:0});