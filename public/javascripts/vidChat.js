var socket=io(),peer=new Peer,video=document.createElement("video"),endbtn=document.querySelectorAll("#end"),selbtn=document.querySelector("#sel"),localvideo=document.querySelector(".localvideo"),remotevideo=document.querySelector(".remotevideo"),loader=document.querySelector("#loader"),myVideo=document.createElement("video"),connected=!1,room="",sendbtn=document.querySelector("#send"),txt=document.querySelector("textarea"),ctn=document.querySelector(".msgCtn"),typingdiv=document.querySelector(".typing"),flash=document.querySelector(".typing small"),istyping=!1,timeout=void 0;socket.emit("inVidChat"),peer.on("open",(e=>{socket.emit("peerId",e)})),myVideo.muted=!0,navigator.mediaDevices.getUserMedia({video:!0,audio:!0}).then((function(e){addVideoStreamLocal(myVideo,e),peer.on("call",(t=>{t.answer(e),this.mediaConnection=t,t.on("close",(()=>{video.remove(),console.log("video removed")})),t.on("stream",(e=>{addVideoStreamRemote(video,e)}))})),socket.on("user-connected",(t=>{connectToNewUser(t,e)}))}));let getTime=()=>{const e=new Date;let t=e.getHours(),o=e.getMinutes();o=o>=0&&o<10?`0${o}`:o;let n=t>=12?"pm":"am";return t=t%12||12,t=12===t||11===t||10===t?t:`0${t}`,{hour:t,minutes:o,ampm:n}};function msgSender(e){""!==e.trim()?(socket.emit("message",{msgs:e,time:getTime()}),txt.value="",clearTimeout(timeout),typingTimeout()):txt.value=""}let flag=e=>{endbtn.forEach((t=>{t.style.pointerEvents=e?"none":"auto"}))};function scrollToBottom(){ctn.scrollTop=ctn.scrollHeight}function typingTimeout(){istyping=!1,socket.emit("typing",{istyping:istyping})}var app=function(){var e=void 0,t=void 0,o=function(){t.addEventListener("click",(function(){return n(e,"nav-active")}))},n=function(e,t){e.classList.contains(t)?e.classList.remove(t):e.classList.add(t)};e=document.querySelector("body"),t=document.querySelector(".menu-icon"),document.querySelectorAll(".nav__list-item"),o()};app();let leave_chat=()=>{connected&&(socket.emit("leaveRoom"),txt.disabled=!0,flag(!0),room="")};function selectText(e){var t=document.querySelector(`.${e}`);if(document.selection)(o=document.body.createTextRange()).moveToElementText(t),o.select();else if(window.getSelection){var o;(o=document.createRange()).selectNodeContents(t),window.getSelection().removeAllRanges(),window.getSelection().addRange(o)}count=0,count2=0}socket.on("connect",(function(){connected=!0})),txt.addEventListener("keyup",(e=>{13===e.keyCode&&msgSender(txt.value)})),txt.addEventListener("keypress",(function(e){13!==e.keyCode&&(istyping=!0,clearTimeout(timeout),timeout=setTimeout(typingTimeout,1e3),socket.emit("typing",{istyping:istyping}))})),socket.on("display",(function(e){!0===e.istyping?(flash.textContent="Stranger is typing",typingdiv.style.display="flex"):(flash.textContent="",typingdiv.style.display="none")})),sendbtn.addEventListener("click",(()=>{msgSender(txt.value)})),socket.on("chatStart",(e=>{ctn.innerHTML=`<h6>${e.msg}</h6>`,e.msg&&(txt.disabled=!1,flag(!1),txt.focus())}));var count=0,count2=0;function addVideoStreamLocal(e,t){e.srcObject=t,e.addEventListener("loadedmetadata",(()=>{e.play()})),localvideo.append(e)}function addVideoStreamRemote(e,t){e.srcObject=t,e.addEventListener("loadedmetadata",(()=>{e.play()})),loader.style.display="none",remotevideo.append(e)}function connectToNewUser(e,t){var o=peer.call(e,t);this.mediaConnection=o,o.on("stream",(e=>{addVideoStreamRemote(video,e)})),o.on("close",(()=>{video.remove()}))}socket.on("replyMessage",(function(e){e.id===socket.id?(count2=0,0===count?(ctn.innerHTML+=`<div class="msgWrapper aRight">\n          <h6>You, ${e.data.time.hour}:${e.data.time.minutes} ${e.data.time.ampm}</h6>\n          <div class="textHolder">\n              <div class="triR"></div>\n              <h3>${e.data.msgs}</h3>\n          </div>\n        </div>`,count++):ctn.innerHTML+=`<div class="msgWrapper aRight">\n        <div class="textHolder">\n            <div class="triR"></div>\n            <h3>${e.data.msgs}</h3>\n        </div>\n      </div>`):(count=0,0===count2?(ctn.innerHTML+=`<div class="msgWrapper">\n          <h6>Stranger, ${e.data.time.hour}:${e.data.time.minutes} ${e.data.time.ampm}</h6>\n          <div class="textHolder">\n              <div class="triL"></div>\n              <h3>${e.data.msgs}</h3>\n          </div>\n        </div>`,count2++):ctn.innerHTML+=`<div class="msgWrapper">\n          <div class="textHolder">\n              <div class="triL"></div>\n              <h3>${e.data.msgs}</h3>\n          </div>\n        </div>`),setTimeout((()=>{ctn.lastChild.style.transform="scale(1)"}),0),scrollToBottom()})),socket.on("chatEnd",(e=>{typingdiv.style.display="none",txt.disabled=!0,flag(!0),e.msg&&(ctn.innerHTML+="<h6>Stranger Disconnected</h6><h5>Waiting for Someone to Connect...</h5>",scrollToBottom()),room=""})),endbtn.forEach((e=>{e.addEventListener("click",(()=>{typingdiv.style.display="none",leave_chat(),loader.style.display="block",ctn.innerHTML+="<h6>You Disconnected</h6><h5>Waiting for Someone to Connect...</h5>",scrollToBottom()}))})),selbtn.addEventListener("click",(()=>{selectText("msgCtn")})),socket.on("user-disconnected",(e=>{this.mediaConnection.close(),loader.style.display="block"})),window.addEventListener("resize",(()=>{scrollToBottom()}));const getDeviceType=()=>{const e=navigator.userAgent;return/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(e)?"tablet":/Mobile|iP(hone|od)|Android|BlackBerry|IEMobile|Kindle|Silk-Accelerated|(hpw|web)OS|Opera M(obi|ini)/.test(e)?(txt.addEventListener("keyup",(()=>{istyping=!0,clearTimeout(timeout),timeout=setTimeout(typingTimeout,1e3),socket.emit("typing",{istyping:istyping})})),"mobile"):"desktop"};getDeviceType();let outlinetxt=document.querySelectorAll(".msgCtn h5 span"),iterator=0;setInterval((()=>{iterator<4?(outlinetxt[iterator].classList.remove("outlined"),outlinetxt[iterator+1].classList.add("outlined"),iterator++):(outlinetxt[iterator].classList.remove("outlined"),outlinetxt[0].classList.add("outlined"),iterator=0)}),448),gsap.from("#room",{duration:1,opacity:0,rotate:90,ease:"power1.inOut",y:"200px"}),gsap.from("#txt",{duration:1,opacity:0,rotate:90,ease:"power1.inOut",y:"100px"}),gsap.from("#btn3",{duration:1,opacity:0,rotate:90,ease:"power1.inOut",y:"-100px"}),gsap.from("#btn4",{duration:1,opacity:0,rotate:90,ease:"power1.inOut",y:"-200px"}),gsap.from(".logo",{duration:1,opacity:0,x:"-100%",ease:"power4.inOut"}),gsap.from(".label",{duration:1,opacity:0,x:"100%",ease:"power4.inOut"}),gsap.from(".msgCtn h5",{duration:1,opacity:0,y:"-100%",ease:"power3.inOut"});